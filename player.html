<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Movies</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="#">Free Movies</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="/">Movies <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/series">Series</a>
                </li>
            </ul>
        </div>
    </nav>
    <div class="container-fluid text-center mt-5">
        <h3 class="text-center" id="title"></h3><br/>
        <video controls width="75%" id="VPlayer">
            <source src="" id="play">
            <track kind="subtitles" srclang="en" src="" id="subs">
        </video>
        <br/>
        <button class="btn btn-sm btn-primary" onclick="remDelay()">&lt;&lt;</button>
        <input class="form-control" style="width: 3rem; display: inline-block;" id="sub_delay" value="0.0"><p> Sec</p>
        <button class="btn btn-sm btn-primary" onclick="addDelay()">&gt;&gt;</button>
    </div>
    <div style="border-top: 1px solid black;" class="mt-3 pt-2 pb-2 text-center">
        Made with ❤️ by Parshwa Shah
    </div>
    <script>
        var delay = 0.0;
        function addOffset(videoId, offset) {
            const video = document.getElementById(videoId);
            if (video) {
                Array.from(video.textTracks).forEach((track) => {
                    if (track.mode === 'showing') {
                        delay += offset || 0.5;
                        Array.from(track.cues).forEach((cue) => {
                            cue.startTime += offset || 0.5;
                            cue.endTime += offset || 0.5;
                        });
                        $('#sub_delay').val(delay);
                        return true;
                    }
                });
            }
            return false;
        }
        function removeOffset(videoId, offset) {
            const video = document.getElementById(videoId);
            if (video) {
                Array.from(video.textTracks).forEach((track) => {
                    if (track.mode === 'showing') {
                        delay -= offset || 0.5;
                        Array.from(track.cues).forEach((cue) => {
                            cue.startTime -= offset || 0.5;
                            cue.endTime -= offset || 0.5;
                        });
                        $('#sub_delay').val(delay);
                        return true;
                    }
                });
            }
            return false;
        }
        function addDelay(){
            addOffset('VPlayer', 0.5);
        }
        function remDelay(){
            removeOffset('VPlayer', 0.5);
        }
        $('#sub_delay').on('change', ()=>{
            addOffset('VPlayer', parseFloat($('#sub_delay').val())-delay);
        });
        var id;
        $(document).ready(()=>{
            id = window.location.href.split('/')[4];
            $.get('/movies/get/'+id, (data)=>{
                $.get('/addMag/'+data.hashes[0].hash, (resp)=>{
                    if(resp=="ERROR"){
                        alert("Something Went Wrong!!");
                    }else{
                        $('#VPlayer').attr('src','/video/'+data.hashes[0].hash);
                    }
                });
                $('#title').html(data.details.title);
                $('#subs').attr('src',data.details.subtitle);
            })
        });
    </script>
</body>
</html>